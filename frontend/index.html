<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</title>
    <link rel="stylesheet" href="./css/fonts.css">
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        .nav-btn {
    text-decoration: none; /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø®Ø· */
    border: none;          /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ø¯ÙˆØ¯ */
}

        body {
            box-sizing: border-box;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Amiri', 'Tajawal', serif;
            background: linear-gradient(135deg, #698163 0%, #5a6f56 100%);
            direction: rtl;
            min-height: 100vh;
        }
        
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 90px 20px 20px 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .main-title {
            font-size: 42px;
            font-weight: bold;
            color: #698163;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .subtitle {
            font-size: 18px;
            color: #666;
            margin-bottom: 20px;
        }
        
        .navigation {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .nav-btn {
            background: #698163;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-family: inherit;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .nav-btn:hover {
            background: #5a6f56;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .nav-btn.active {
            background: #000;
            transform: translateY(-2px);
        }
        
        .logout-btn {
            background: #e74c3c !important;
        }
        
        .logout-btn:hover {
            background: #c0392b !important;
        }
        
        .app-container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 15px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
            overflow: hidden;
            min-height: 600px;
            position: relative;
            z-index: 10;
        }
        
        .app-content {
            display: none;
            padding: 30px;
        }
        
        .app-content.active {
            display: block;
        }
        
        .welcome-screen {
            text-align: center;
            padding: 80px 20px;
            color: #698163;
        }
        
        .welcome-screen h2 {
            font-size: 32px;
            margin-bottom: 20px;
        }
        
        .welcome-screen p {
            font-size: 18px;
            line-height: 1.6;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .app-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }
        
        .app-card {
            background: linear-gradient(135deg, #698163, #5a6f56);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        
        .app-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.3);
        }
        
        .app-card h3 {
            font-size: 24px;
            margin-bottom: 15px;
        }
        
        .app-card p {
            font-size: 16px;
            line-height: 1.5;
            opacity: 0.9;
        }
        
        .app-icon {
            font-size: 48px;
            margin-bottom: 20px;
            display: block;
        }
        
        .placeholder-content {
            text-align: center;
            padding: 100px 20px;
            color: #698163;
        }
        
        .placeholder-content h2 {
            font-size: 28px;
            margin-bottom: 15px;
        }
        
        .placeholder-content p {
            font-size: 16px;
            opacity: 0.7;
        }
        
        @media (max-width: 768px) {
            .navigation {
                flex-direction: column;
                align-items: center;
            }
            
            .nav-btn {
                width: 200px;
            }
            
            .main-title {
                font-size: 32px;
            }
            
            .app-cards {
                grid-template-columns: 1fr;
            }
            
        }

        /* ===== Enhancements merged ===== */
        body {
            background: linear-gradient(135deg, #698163 0%, #5a6f56 50%, #4a5a47 100%);
            background-attachment: fixed;
            position: relative;
            overflow-x: hidden;
        }
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 80%, rgba(255,255,255,0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(255,255,255,0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }
        .header {
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15), 0 0 0 1px rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: visible;
        }
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #698163, #5a6f56, #698163);
            background-size: 200% 100%;
            animation: shimmer 3s ease-in-out infinite;
        }
        @keyframes shimmer {
            0%, 100% { background-position: -200% 0; }
            50% { background-position: 200% 0; }
        }
        .subtitle {
            font-size: 20px;
            margin-bottom: 30px;
            font-weight: 500;
            opacity: 0.8;
        }
        .navigation { gap: 25px; flex-wrap: wrap; }
        .nav-btn {
            background: linear-gradient(135deg, #698163, #5a6f56);
            padding: 18px 35px;
            border-radius: 15px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 25px rgba(105, 129, 99, 0.3), 0 0 0 1px rgba(255,255,255,0.1);
            position: relative;
            overflow: hidden;
        }
        .nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        .nav-btn:hover::before { left: 100%; }
        .nav-btn:hover {
            background: linear-gradient(135deg, #5a6f56, #4a5a47);
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 15px 35px rgba(105, 129, 99, 0.4), 0 0 0 1px rgba(255,255,255,0.2);
        }
        .nav-btn.active {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 15px 35px rgba(44, 62, 80, 0.4);
        }
        .logout-btn { background: linear-gradient(135deg, #e74c3c, #c0392b) !important; }
        .logout-btn:hover { background: linear-gradient(135deg, #c0392b, #a93226) !important; }
        .app-container {
            border-radius: 20px;
            box-shadow: 0 25px 70px rgba(0,0,0,0.15), 0 0 0 1px rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
        }
        .app-content { padding: 40px; animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px);} to { opacity: 1; transform: translateY(0);} }
        .welcome-screen h2 { font-weight: 700; position: relative; }
        .welcome-screen h2::after {
            content: '';
            position: absolute;
            bottom: -10px; left: 50%; transform: translateX(-50%);
            width: 80px; height: 3px;
            background: linear-gradient(90deg, #698163, #5a6f56);
            border-radius: 2px;
        }
        .app-cards { grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 35px; }
        .app-card { padding: 40px; border-radius: 20px; box-shadow: 0 15px 40px rgba(105, 129, 99, 0.3), 0 0 0 1px rgba(255,255,255,0.1); position: relative; overflow: hidden; }
        .app-card::before { content: ''; position: absolute; inset: 0; background: linear-gradient(135deg, rgba(255,255,255,0.1), transparent); opacity: 0; transition: opacity 0.3s; }
        .app-card:hover::before { opacity: 1; }
        .app-card:hover { transform: translateY(-8px) scale(1.02); box-shadow: 0 25px 60px rgba(105, 129, 99, 0.4), 0 0 0 1px rgba(255,255,255,0.2); }
        .app-card h3 { font-size: 28px; font-weight: 700; }
        .app-icon { font-size: 64px; margin-bottom: 25px; display: block; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2)); }
        .placeholder-content { padding: 120px 20px; }
        .loading-spinner { display: inline-block; width: 20px; height: 20px; border: 3px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: #fff; animation: spin 1s ease-in-out infinite; margin-left: 10px; }
        @keyframes spin { to { transform: rotate(360deg);} }
        .notification { position: fixed; top: 20px; right: 20px; background: linear-gradient(135deg, #27ae60, #2ecc71); color: #fff; padding: 15px 25px; border-radius: 10px; box-shadow: 0 10px 30px rgba(39,174,96,0.3); transform: translateX(400px); transition: transform 0.3s ease-out; z-index: 1000; }
        .notification.show { transform: translateX(0); }
        .notification.error { background: linear-gradient(135deg, #e74c3c, #c0392b); box-shadow: 0 10px 30px rgba(231,76,60,0.3); }
        .top-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: linear-gradient(180deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0.08) 50%, rgba(255,255,255,0.02) 100%);
            backdrop-filter: blur(12px);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px 0 30px;
            z-index: 1000;
            box-shadow: none;
        }
        
        .user-dropdown { 
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .user-menu-btn { 
            background: rgba(255,255,255,0.1);
            color: #fff; 
            border: none; 
            padding: 0; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            transition: all 0.3s ease; 
            width: 52px;
            height: 52px;
            border-radius: 50%;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        .user-menu-btn:hover { 
            transform: scale(1.08);
            background: rgba(255,255,255,0.15);
            box-shadow: 0 8px 25px rgba(0,0,0,0.25);
        }
        .user-menu-btn:active {
            transform: scale(0.95);
        }
        .user-menu-btn img {
            width: 36px;
            height: 36px;
            object-fit: contain;
            transition: all 0.3s ease;
        }
        .user-dropdown.open .user-menu-btn {
            background: rgba(255,255,255,0.2);
        }
        .user-dropdown.open .user-menu-btn img {
            transform: rotate(15deg);
        }
        .user-info { display: none; }
        .user-name { display: none; }
        .user-role { display: none; }
        .user-avatar { display: none; }
        .user-menu-btn::after {
            display: none;
        }
        .dropdown-menu { 
            position: fixed; 
            top: 0; 
            right: 0; 
            width: 300px; 
            height: 100vh; 
            background: linear-gradient(135deg, #698163, #5a6f56); 
            color: white;
            padding: 80px 0 20px 0; 
            opacity: 0; 
            visibility: hidden; 
            transform: translateX(100%); 
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
            box-shadow: -10px 0 30px rgba(0,0,0,0.3);
            overflow-y: auto;
            z-index: 1001;
        }
        .user-dropdown.open .dropdown-menu { 
            opacity: 1; 
            visibility: visible; 
            transform: translateX(0); 
        }
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 999;
        }
        .user-dropdown.open .sidebar-overlay {
            opacity: 1;
            visibility: visible;
        }
        .dropdown-header { padding: 20px; border-bottom: 1px solid rgba(255,255,255,0.2); margin-bottom: 20px; }
        .dropdown-user-name { font-size: 18px; font-weight: bold; color: white; margin-bottom: 8px; }
        .dropdown-user-role { font-size: 14px; color: rgba(255,255,255,0.8); background: rgba(255,255,255,0.1); padding: 6px 15px; border-radius: 20px; display: inline-block; }
        .dropdown-item { display: flex; align-items: center; gap: 15px; padding: 15px 25px; color: white; text-decoration: none; transition: all 0.3s ease; cursor: pointer; border: none; background: none; width: 100%; text-align: right; font-family: inherit; font-size: 16px; border-radius: 0; }
        .dropdown-item:hover { background: rgba(255,255,255,0.1); color: white; }
        .dropdown-item.logout { color: #ff6b6b; border-top: 1px solid rgba(255,255,255,0.2); margin-top: 20px; }
        .dropdown-item.logout:hover { background: rgba(255,107,107,0.1); color: #ff5252; }
        .dropdown-icon { font-size: 16px; width: 20px; text-align: center; }
        
        /* Ù†Ø¸Ø§Ù… Ù…ØªØ§Ø¨Ø¹Ø© Ø³ÙŠØ± Ø§Ù„Ø¹Ù…Ù„ÙŠØ© */
        .tracking-container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .filter-section {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: end;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 200px;
        }
        
        .filter-group label {
            font-weight: bold;
            color: #698163;
            font-size: 14px;
        }
        
        .filter-group select,
        .filter-group input {
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: #698163;
        }
        
        .requests-table-container {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .requests-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .requests-table th {
            background: linear-gradient(135deg, #698163, #5a6f56);
            color: white;
            padding: 15px 10px;
            text-align: center;
            font-weight: bold;
            font-size: 14px;
        }
        
        .requests-table td {
            padding: 12px 10px;
            text-align: center;
            border-bottom: 1px solid #f0f0f0;
            font-size: 13px;
        }
        
        .requests-table tr:hover {
            background: rgba(105, 129, 99, 0.05);
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-approved {
            background: #d4edda;
            color: #155724;
        }
        
        .status-rejected {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-completed {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .action-btn {
            background: linear-gradient(135deg, #698163, #5a6f56);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            margin: 0 2px;
            transition: all 0.3s ease;
        }
        
        .action-btn:hover {
            background: linear-gradient(135deg, #5a6f56, #4a5a47);
            transform: translateY(-1px);
        }
        
        @media (max-width: 768px) {
            .filter-section {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-group {
                min-width: auto;
            }
            
            .requests-table {
                font-size: 12px;
            }
            
            .requests-table th,
            .requests-table td {
                padding: 8px 5px;
            }
        }
        @media (max-width: 768px) {
            .top-bar { padding: 0 15px; height: 60px; }
            .top-bar-brand { padding: 8px 12px; }
            .top-bar-brand img { width: 34px; height: 34px; padding: 4px; }
            .top-bar-brand-text .brand-sub { display: none; }
            .top-bar-title { font-size: 16px; }
            .top-bar-actions { gap: 8px; }
            .top-request-btn { display: none; }
            .top-notifications-panel { right: 15px; width: calc(100% - 30px); top: 80px; }
            .main-container { padding: 80px 15px 15px 15px; }
            .navigation { gap: 15px; }
            .nav-btn { width: 250px; padding: 15px 25px; }
            .main-title { font-size: 36px; }
            .app-cards { grid-template-columns: 1fr; gap: 25px; }
            .header { padding: 30px 20px; }
            .app-content { padding: 30px 20px; }
            .welcome-screen { padding: 60px 15px; }
            .welcome-screen h2 { font-size: 28px; }
            .welcome-screen p { font-size: 18px; }
            .user-dropdown { top: 15px; right: 15px; }
            .user-menu-btn { min-width: 150px; padding: 10px 15px; font-size: 12px; }
            .dropdown-menu { width: 280px; }
        }
        @media (max-width: 480px) {
            .main-container { padding: 15px; }
            .main-title { font-size: 28px; }
            .subtitle { font-size: 16px; }
            .nav-btn { width: 200px; font-size: 14px; }
        }
        .top-bar-content { 
            display: flex; 
            align-items: center; 
            gap: 20px;
        }
        .top-bar-brand {
            display: flex;
            align-items: center;
            gap: 14px;
        }
        .top-bar-brand img {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            object-fit: contain;
            background: rgba(255,255,255,0.95);
            padding: 6px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        .top-bar-brand-text {
            display: flex;
            flex-direction: column;
            line-height: 1.2;
            color: #fff;
        }
        .top-bar-brand-text .brand-main {
            font-size: 16px;
            font-weight: 700;
            text-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        .top-bar-brand-text .brand-sub {
            font-size: 12px;
            font-weight: 500;
            opacity: 0.85;
            letter-spacing: 0.8px;
        }
        .top-bar-title {
            color: #fff;
            font-size: 17px;
            font-weight: 600;
            letter-spacing: 0.3px;
            text-shadow: 0 2px 6px rgba(0,0,0,0.15);
            padding-left: 15px;
            border-left: 2px solid rgba(255,255,255,0.2);
        }
        .top-bar-actions { display: flex; align-items: center; gap: 15px; }
        .top-request-btn, .top-notification-btn {
            border: none;
            border-radius: 14px;
            padding: 10px 18px;
            font-size: 14px;
            font-family: inherit;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .top-request-btn {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: #fff;
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.3);
            border-radius: 14px;
            padding: 12px 24px;
            font-weight: 600;
        }
        .top-request-btn:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 10px 28px rgba(39, 174, 96, 0.4);
        }
        .top-notification-btn {
            position: relative;
            background: rgba(255,255,255,0.1);
            color: #fff;
            width: 52px;
            height: 52px;
            justify-content: center;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            border-radius: 50%;
            font-size: 20px;
        }
        .top-notification-btn:hover {
            background: rgba(255,255,255,0.15);
            transform: scale(1.08);
            box-shadow: 0 8px 25px rgba(0,0,0,0.25);
        }
        .top-notification-badge {
            position: absolute;
            top: -6px;
            right: -6px;
            min-width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #e74c3c;
            color: #fff;
            font-size: 11px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0 5px;
            font-weight: 700;
            box-shadow: 0 4px 10px rgba(231, 76, 60, 0.4);
        }
        .top-notifications-panel {
            position: fixed;
            top: 80px;
            right: 35px;
            width: 320px;
            max-height: 420px;
            background: rgba(255,255,255,0.97);
            border-radius: 18px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.18);
            border: 1px solid rgba(255,255,255,0.6);
            backdrop-filter: blur(10px);
            display: none;
            flex-direction: column;
            overflow: hidden;
            z-index: 1100;
        }
        .top-notifications-panel.active { display: flex !important; }
        .top-notifications-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 18px;
            background: linear-gradient(135deg, rgba(105,129,99,0.15), rgba(90,111,86,0.08));
            font-size: 14px;
            font-weight: 600;
            color: #2c3e50;
        }
        .top-notifications-header button {
            border: none;
            background: none;
            color: #427f77;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
        }
        .top-notifications-header button:hover { text-decoration: underline; }
        .top-notifications-list {
            list-style: none;
            margin: 0;
            padding: 0;
            max-height: 360px;
            overflow-y: auto;
        }
        .top-notifications-list li {
            padding: 14px 18px;
            border-bottom: 1px solid rgba(236, 240, 241, 0.8);
            font-size: 13px;
            line-height: 1.6;
            color: #34495e;
        }
        .top-notifications-list li.unread {
            background: rgba(105,129,99,0.08);
            font-weight: 600;
        }
        .top-notifications-list li.top-notifications-empty {
            text-align: center;
            color: #7f8c8d;
            font-weight: 600;
        }
        .top-notifications-list li:last-child { border-bottom: none; }
        .top-notifications-list li small {
            display: block;
            margin-top: 6px;
            color: #7f8c8d;
            font-weight: normal;
        }

        body.has-top-bar .main-container {
            padding-top: 120px;
        }
        body.has-top-bar .top-notifications-panel {
            top: 95px;
        }
    </style>
</head>
<body>
    <!-- Top Bar -->
    <div class="top-bar" id="topBar" style="display: none;">
        <div class="top-bar-content">
            <div class="top-bar-brand" title="ØµØ±Ø­ Ø§Ù„Ù‚Ø§Ø¨Ø¶Ø©">
                <img src="./img/logo-ar.png" alt="ØµØ±Ø­ Ø§Ù„Ù‚Ø§Ø¨Ø¶Ø©">
                <div class="top-bar-brand-text">
                    <span class="brand-main">ØµØ±Ø­ Ø§Ù„Ù‚Ø§Ø¨Ø¶Ø©</span>
                    <span class="brand-sub">Sarh Holding</span>
                </div>
            </div>
            <span class="top-bar-title">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</span>
        </div>
        <div class="top-bar-actions">
            <button class="top-request-btn" type="button" onclick="window.location.href='./purchase_request.html'">
                Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
            </button>
            <button class="top-notification-btn" type="button" id="topNotificationsBtn">
                ğŸ””
                <span class="top-notification-badge" id="topNotificationsBadge" style="display: none;">0</span>
            </button>
            <div class="user-dropdown" id="userDropdown">
                <button class="user-menu-btn" onclick="toggleUserMenu()" title="ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©">
                    <img src="./img/logo-ar.png" alt="Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©">
                </button>
                <div class="sidebar-overlay" onclick="toggleUserMenu()"></div>
                <div class="dropdown-menu">
                    <div class="dropdown-header">
                        <div class="dropdown-user-name" id="dropdownUserName">Ù…Ø³ØªØ®Ø¯Ù…</div>
                        <div class="dropdown-user-role" id="dropdownUserRole">Ù…ÙˆØ¸Ù</div>
                    </div>
                    <button class="dropdown-item" onclick="showNotification('Ù‚Ø±ÙŠØ¨Ø§Ù‹: Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ', 'info')">
                        <span class="dropdown-icon">ğŸ‘¤</span>
                        Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
                    </button>
                    <button class="dropdown-item" onclick="showNotification('Ù‚Ø±ÙŠØ¨Ø§Ù‹: Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', 'info')">
                        <span class="dropdown-icon">âš™ï¸</span>
                        Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                    </button>
                    <button class="dropdown-item logout" onclick="logout()">
                        <span class="dropdown-icon">ğŸšª</span>
                        ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="top-notifications-panel" id="topNotificationsPanel" style="display: none;">
        <div class="top-notifications-header">
            <span>Ø¥Ø´Ø¹Ø§Ø±Ø§ØªÙŠ</span>
            <button type="button" id="markTopNotificationsRead">ØªØ¹Ù„ÙŠÙ… Ø§Ù„ÙƒÙ„ ÙƒÙ…Ù‚Ø±ÙˆØ¡</button>
        </div>
        <ul class="top-notifications-list" id="topNotificationsList"></ul>
    </div>
    
    <div class="main-container">
        <div class="header">
            <h1 class="main-title">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h1>
            <p class="subtitle">Ø¥Ø¯Ø§Ø±Ø© Ø´Ø§Ù…Ù„Ø© ÙˆÙ…ØªØ·ÙˆØ±Ø© Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ£ÙˆØ§Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡</p>
            
            <div class="navigation">
                <a class="nav-btn" href="./purchase_request.html">ğŸ“„Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡</a>
                <a class="nav-btn" href="./login.html" id="loginLink">ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
                <button class="nav-btn logout-btn" onclick="logout()" id="logoutBtn" style="display: none;">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
            </div>
        </div>
        
        <div class="app-container">
            <!-- Home Screen -->
            <div id="home" class="app-content active">
                <div class="welcome-screen">
                    <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙÙŠ ØµØ±Ø­ Ø§Ù„Ù‚Ø§Ø¨Ø¶Ø©</h2>
                    <p>Ù†Ø¸Ø§Ù… Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¬Ù…ÙŠØ¹ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø´Ø±Ø§Ø¡ ÙÙŠ Ù…Ø¤Ø³Ø³ØªÙƒ. ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡ ÙˆØ£ÙˆØ§Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¨Ø³Ù‡ÙˆÙ„Ø©.</p>
                    
                    <div class="app-cards">
                        <div class="app-card" onclick="window.location.href='./purchase_request.html'">
                            <span class="app-icon">ğŸ“‹</span>
                            <h3>Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡</h3>
                            <p>Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©</p>
                        </div>
                        <div class="app-card" onclick="showApp('track-request')">
                            <span class="app-icon">ğŸ”</span>
                            <h3>Ù…ØªØ§Ø¨Ø¹Ø© Ø·Ù„Ø¨Ø§ØªÙŠ</h3>
                            <p>Ù…ØªØ§Ø¨Ø¹Ø© Ø­Ø§Ù„Ø© Ø·Ù„Ø¨Ø§ØªÙŠ ÙˆÙ…Ø±Ø§Ø­Ù„ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Purchase Request Placeholder -->
            <div id="purchase-request" class="app-content">
  <div class="placeholder-content">
    <h2>ğŸ“‹ ØªØ·Ø¨ÙŠÙ‚ Ø·Ù„Ø¨ Ø§Ù„Ø´Ø±Ø§Ø¡</h2>
    <p>Ù‡Ù†Ø§ Ø³ÙŠØªÙ… Ø¥Ø¯Ø±Ø§Ø¬ ÙƒÙˆØ¯ ØªØ·Ø¨ÙŠÙ‚ Ø·Ù„Ø¨ Ø§Ù„Ø´Ø±Ø§Ø¡</p>

    <a class="nav-btn" href="./purchase_request.html" style="margin-top:20px; display:inline-block;">
      ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ Ø·Ù„Ø¨ Ø§Ù„Ø´Ø±Ø§Ø¡
    </a>
  </div>
</div>
            <div id="track-request" class="app-content">
                <div class="tracking-container">
                    <h2>ğŸ” Ù…ØªØ§Ø¨Ø¹Ø© Ø·Ù„Ø¨Ø§ØªÙŠ</h2>
                    <p>Ù…ØªØ§Ø¨Ø¹Ø© Ø­Ø§Ù„Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ ÙˆÙ…Ø±Ø§Ø­Ù„ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</p>
                    
                    <div class="filter-section">
                        <div class="filter-group">
                            <label>Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨:</label>
                            <select id="statusFilter" onchange="filterRequests()">
                                <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                                <option value="pending">ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</option>
                                <option value="approved">Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡</option>
                                <option value="rejected">Ù…Ø±ÙÙˆØ¶</option>
                                <option value="completed">Ù…ÙƒØªÙ…Ù„</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</label>
                            <input type="text" id="orderNumberFilter" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨..." onkeyup="filterRequests()">
                        </div>
                        <button class="nav-btn" onclick="loadRequests()" style="margin-top: 10px;">
                            ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                        </button>
                    </div>
                    
                    <div class="requests-table-container">
                        <table class="requests-table" id="requestsTable">
                            <thead>
                                <tr>
                                    <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                                    <th>Ø§Ù„Ù…Ù‚Ø¯Ù…</th>
                                    <th>Ø§Ù„Ù‚Ø³Ù…</th>
                                    <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                                    <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</th>
                                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="requestsTableBody">
                                <tr>
                                    <td colspan="7" style="text-align: center; padding: 40px; color: #666;">
                                        Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
  </div>
</div>
            
        </div>
        
    </div>

    <div id="notification" class="notification"></div>

    <script>
        // Ø­Ù…Ø§ÙŠØ© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ±
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            enforceRoleAccess('requester');
        });

        function checkAuth() {
            const token = localStorage.getItem('token');
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            const logoutBtn = document.getElementById('logoutBtn');
            const loginLink = document.getElementById('loginLink');
            const userDropdown = document.getElementById('userDropdown');
            const topBar = document.getElementById('topBar');
            
            if (token && user.role) {
                if (topBar) topBar.style.display = 'flex';
                if (logoutBtn) logoutBtn.style.display = 'none';
                if (loginLink) loginLink.style.display = 'none';
                document.body.classList.add('has-top-bar');
                updateUserInfo(user);
                initTopNotifications();
            } else {
                if (topBar) topBar.style.display = 'none';
                if (logoutBtn) logoutBtn.style.display = 'none';
                if (loginLink) loginLink.style.display = 'inline-block';
                document.body.classList.remove('has-top-bar');
                teardownTopNotifications();
            }
        }

        function updateUserInfo(user) {
            const roleNames = { requester: 'Ù…ÙˆØ¸Ù Ø·Ù„Ø¨Ø§Øª', manager: 'Ù…Ø¯ÙŠØ±', finance: 'Ù…ÙˆØ¸Ù Ù…Ø§Ù„ÙŠØ©', disbursement: 'Ù…ÙˆØ¸Ù ØµØ±Ù', admin: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…', procurement: 'Ù…ÙˆØ¸Ù Ù…Ø´ØªØ±ÙŠØ§Øª' };
            const userName = user.full_name || user.name || user.username || 'Ù…Ø³ØªØ®Ø¯Ù…';
            const userRole = roleNames[user.role] || 'Ù…ÙˆØ¸Ù';
            const hn = document.getElementById('headerUserName');
            const hr = document.getElementById('headerUserRole');
            const dn = document.getElementById('dropdownUserName');
            const dr = document.getElementById('dropdownUserRole');
            if (hn) hn.textContent = userName;
            if (hr) hr.textContent = userRole;
            if (dn) dn.textContent = userName;
            if (dr) dr.textContent = userRole;
        }

        function toggleUserMenu() {
            const dropdown = document.getElementById('userDropdown');
            if (dropdown) dropdown.classList.toggle('open');
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†Ø§ØµØ±
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('userDropdown');
            if (!dropdown) return;
            
            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©
            if (dropdown.classList.contains('open') && 
                !dropdown.querySelector('.user-menu-btn').contains(event.target) &&
                !dropdown.querySelector('.dropdown-menu').contains(event.target)) {
                dropdown.classList.remove('open');
            }
        });

        function showNotification(message, type = 'success') {
            const n = document.getElementById('notification');
            if (!n) return;
            n.textContent = message;
            n.className = `notification ${type}`;
            n.classList.add('show');
            setTimeout(() => n.classList.remove('show'), 3000);
        }

        function showCustomConfirm(message, onConfirm) {
            const modal = document.createElement('div');
            modal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.5);display:flex;justify-content:center;align-items:center;z-index:10000;backdrop-filter:blur(5px)';
            const content = document.createElement('div');
            content.style.cssText = 'background:#fff;padding:30px;border-radius:15px;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,0.3);max-width:400px;margin:20px;';
            content.innerHTML = '<h3 style="margin-bottom:20px;color:#698163;font-size:24px;">'+message+'</h3>\
            <div style="display:flex;gap:15px;justify-content:center;">\
            <button id="confirmBtn" style="background:linear-gradient(135deg,#e74c3c,#c0392b);color:#fff;border:none;padding:12px 25px;border-radius:8px;cursor:pointer;font-size:16px;font-weight:bold;">Ù†Ø¹Ù…ØŒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>\
            <button id="cancelBtn" style="background:linear-gradient(135deg,#95a5a6,#7f8c8d);color:#fff;border:none;padding:12px 25px;border-radius:8px;cursor:pointer;font-size:16px;font-weight:bold;">Ø¥Ù„ØºØ§Ø¡</button></div>';
            modal.appendChild(content);
            document.body.appendChild(modal);
            document.getElementById('confirmBtn').onclick = () => { document.body.removeChild(modal); onConfirm && onConfirm(); };
            document.getElementById('cancelBtn').onclick = () => document.body.removeChild(modal);
            modal.onclick = (e) => { if (e.target === modal) document.body.removeChild(modal); };
        }

        function logout() {
            showCustomConfirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ', function() {
                const logoutBtn = document.getElementById('logoutBtn');
                if (logoutBtn) {
                    const original = logoutBtn.innerHTML;
                    logoutBtn.innerHTML = 'ğŸšª Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬... <span class="loading-spinner"></span>';
                    logoutBtn.disabled = true;
                }
                teardownTopNotifications();
                setTimeout(() => {
                    localStorage.removeItem('token');
                    localStorage.removeItem('user');
                    showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    setTimeout(() => window.location.reload(), 1500);
                }, 1000);
            });
        }

        document.body.style.opacity = '0';
        document.body.style.transition = 'opacity 0.5s ease-out';
        setTimeout(() => { document.body.style.opacity = '1'; }, 100);

        // Ù†Ø¸Ø§Ù… Ù…ØªØ§Ø¨Ø¹Ø© Ø³ÙŠØ± Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù†Ø³Ø¨ÙŠ Ù„Ù„Ù€ API Ø¹Ø¨Ø± Nginx
        const API_BASE = '/api';
        let allRequests = [];
        let topNotifications = [];
        let topNotificationsIntervalId = null;
        let topNotificationsInitialized = false;
        let topNotificationsOutsideClickRegistered = false;
        
        function loadRequests() {
            const token = localStorage.getItem('token');
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            
            if (!token || !user.id) {
                showNotification('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
                return;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ø¯ÙŠÙ‡ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø·Ù„Ø¨Ø§Øª
            console.log('User role:', user.role);
            
            // Ø¯Ø¹Ù… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ù…Ø¤Ù‚ØªØ§Ù‹ Ù„Ù„ØªØ·ÙˆÙŠØ±
            if (user.role && !['requester', 'admin', 'manager', 'finance', 'disbursement'].includes(user.role)) {
                showNotification('Ø¯ÙˆØ±Ùƒ: ' + user.role + ' - Ø³ÙŠØªÙ… Ø¯Ø¹Ù…Ù‡ Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'warning');
            }
            
            const tbody = document.getElementById('requestsTableBody');
            tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: #666;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø·Ù„Ø¨Ø§ØªÙƒ...</td></tr>';
            
            // Ø¬Ù„Ø¨ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙ‚Ø·
            console.log('Fetching from:', `${API_BASE}/user/requests`);
            console.log('User:', user);
            console.log('Token:', token ? 'Present' : 'Missing');
            
            fetch(`${API_BASE}/user/requests`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            })
            .then(response => {
                console.log('Response status:', response.status);
                console.log('Response headers:', response.headers);
                
                if (response.status === 401) {
                    showNotification('Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¬Ù„Ø³Ø©. ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰', 'error');
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                    window.location.href = 'login.html';
                    return;
                }
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© JSON ØµØ§Ù„Ø­Ø©
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    throw new Error('Response is not JSON');
                }
                
                return response.json();
            })
            .then(data => {
                allRequests = data || [];
                displayRequests(allRequests);
                showNotification(`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${allRequests.length} Ù…Ù† Ø·Ù„Ø¨Ø§ØªÙƒ`, 'success');
            })
            .catch(error => {
                console.error('Error loading requests:', error);
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: #e74c3c;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø·Ù„Ø¨Ø§ØªÙƒ: ' + error.message + '</td></tr>';
                showNotification('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø·Ù„Ø¨Ø§ØªÙƒ: ' + error.message, 'error');
            });
        }
        
        function displayRequests(requests) {
            const tbody = document.getElementById('requestsTableBody');
            
            if (requests.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: #666;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù„Ùƒ Ø¨Ø¹Ø¯</td></tr>';
                return;
            }
            
            tbody.innerHTML = requests.map(request => {
                const statusClass = getStatusClass(request.status);
                const statusText = getStatusText(request.status);
                
                // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ Ø­Ø³Ø¨ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„ÙØ¹Ù„ÙŠ
                let createdDate = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                if (request.created_at) {
                    const date = new Date(request.created_at);
                    createdDate = date.toLocaleDateString('en-GB', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit'
                    });
                }
                
                // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„Ø© Ø­Ø³Ø¨ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù…Ø±Ø³Ù„
                const currency = request.currency || 'SYP';
                let currencySymbol = 'Ù„.Ø³';
                let currencyText = 'Ø³ÙˆØ±ÙŠ';
                
                if (currency === 'USD' || currency === 'Ø¯ÙˆÙ„Ø§Ø±') {
                    currencySymbol = '$';
                    currencyText = 'Ø¯ÙˆÙ„Ø§Ø±';
                } else if (currency === 'SYP' || currency === 'Ø³ÙˆØ±ÙŠ') {
                    currencySymbol = 'Ù„.Ø³';
                    currencyText = 'Ø³ÙˆØ±ÙŠ';
                }
                
                return `
                    <tr>
                        <td>${request.order_number || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                        <td>${request.requester || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                        <td>${request.department || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                        <td>${createdDate}</td>
                        <td>${request.total_amount ? `${request.total_amount} ${currencySymbol}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>
                            <button class="action-btn" onclick="viewRequest(${request.id})">Ø¹Ø±Ø¶</button>
                            <button class="action-btn" onclick="printRequest(${request.id})">Ø·Ø¨Ø§Ø¹Ø©</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        function getStatusClass(status) {
            switch(status) {
                case 'pending': return 'status-pending';
                case 'approved': return 'status-approved';
                case 'rejected': return 'status-rejected';
                case 'completed': return 'status-completed';
                default: return 'status-pending';
            }
        }
        
        function getStatusText(status) {
            switch(status) {
                case 'pending': return 'ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±';
                case 'approved': return 'Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡';
                case 'rejected': return 'Ù…Ø±ÙÙˆØ¶';
                case 'completed': return 'Ù…ÙƒØªÙ…Ù„';
                default: return 'ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±';
            }
        }
        
        function filterRequests() {
            const statusFilter = document.getElementById('statusFilter').value;
            const orderNumberFilter = document.getElementById('orderNumberFilter').value.toLowerCase();
            
            let filteredRequests = allRequests;
            
            if (statusFilter) {
                filteredRequests = filteredRequests.filter(request => request.status === statusFilter);
            }
            
            if (orderNumberFilter) {
                filteredRequests = filteredRequests.filter(request => 
                    (request.order_number || '').toLowerCase().includes(orderNumberFilter)
                );
            }
            
            displayRequests(filteredRequests);
        }
        
        let currentRequestForModal = null;
        
        function formatCurrency(amount, currency) {
            if (!amount) return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            
            let currencySymbol = 'Ù„.Ø³';
            if (currency === 'USD') {
                currencySymbol = '$';
            } else if (currency === 'EUR') {
                currencySymbol = 'â‚¬';
            }
            
            return `${amount} ${currencySymbol}`;
        }
        
        async function viewRequest(requestId) {
            try {
                // Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù… Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ approval_data
                const response = await fetch(`${API_BASE}/requests/${requestId}`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                let request;
                if (response.ok) {
                    request = await response.json();
                } else {
                    showNotification('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨', 'error');
                    return;
                }
                
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ¹Ù„ÙŠØ© Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙ‚Ø·
                
                currentRequestForModal = request;
                showRequestModal(request);
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨', 'error');
            }
        }
        
        function showRequestModal(request) {
            const modal = document.getElementById('requestModal');
            const modalBody = document.getElementById('modalBody');
            
            const formattedTotal = formatCurrency(request.total_amount, request.currency);
            const createdDate = request.created_at ? new Date(request.created_at).toLocaleDateString('en-US') : 
                              (request.date ? new Date(request.date).toLocaleDateString('en-US') : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯');
            
            // Ø¨Ù†Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£ØµÙ†Ø§Ù
            let itemsTable = '';
            if (request.items && request.items.length > 0) {
                itemsTable = `
                    <h3>Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</h3>
                    <table class="items-table">
                        <thead>
                            <tr>
                                <th>Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù</th>
                                <th>Ø§Ù„ÙˆØ­Ø¯Ø©</th>
                                <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                <th>Ø§Ù„Ø³Ø¹Ø±</th>
                                <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${request.items.map(item => `
                                <tr>
                                    <td>${item.item_name || item.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                                    <td>${item.unit || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                                    <td>${item.quantity || 0}</td>
                                    <td>${item.price || 0}</td>
                                    <td>${item.total || ((item.quantity || 0) * (item.price || 0))}</td>
                                </tr>
                                ${item.specification ? `<tr><td colspan="5" style="font-style: italic; color: #666;">Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª: ${item.specification}</td></tr>` : ''}
                            `).join('')}
                        </tbody>
                    </table>
                `;
            }
            
            modalBody.innerHTML = `
                <div class="detail-grid">
                    <div class="detail-item">
                        <span class="detail-label">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</span>
                        <span class="detail-value">${request.order_number || request.id}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨</span>
                        <span class="detail-value">${request.requester || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Ø§Ù„Ù‚Ø³Ù…</span>
                        <span class="detail-value">${request.department || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</span>
                        <span class="detail-value">${createdDate}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Ù…ÙˆØ¹Ø¯ Ø§Ù„ØªØ³Ù„ÙŠÙ…</span>
                        <span class="detail-value">${request.delivery_date || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªØ³Ù„ÙŠÙ…</span>
                        <span class="detail-value">${request.delivery_address || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">ÙƒÙˆØ¯ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</span>
                        <span class="detail-value">${request.project_code || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Ø§Ù„Ø¹Ù…Ù„Ø©</span>
                        <span class="detail-value">${request.currency || 'Ù„.Ø³'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
                        <span class="detail-value">${formattedTotal}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Ø§Ù„Ø­Ø§Ù„Ø©</span>
                        <span class="detail-value">${getStatusText(request.status)}</span>
                    </div>
                </div>
                ${itemsTable}
            `;
            
            modal.style.display = 'flex';
        }
        
        function closeRequestModal() {
            document.getElementById('requestModal').style.display = 'none';
            currentRequestForModal = null;
        }
        
        function printCurrentRequest() {
            if (currentRequestForModal) {
                // Ø¥Ù†Ø´Ø§Ø¡ ØµÙØ­Ø© Ø·Ø¨Ø§Ø¹Ø© Ø¨Ù†ÙØ³ ØªÙ†Ø³ÙŠÙ‚ purchase_request.html
                const printWindow = window.open('', '_blank');
                const request = currentRequestForModal;
                
                // Ø¨Ù†Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£ØµÙ†Ø§Ù
                let itemsTable = '';
                if (request.items && request.items.length > 0) {
                    itemsTable = request.items.map(item => `
                        <tr>
                            <td>${item.item_name || item.name || ''}</td>
                            <td>${item.unit || ''}</td>
                            <td>${item.quantity || 0}</td>
                            <td>${item.price || 0}</td>
                            <td>${item.total || ((item.quantity || 0) * (item.price || 0))}</td>
                        </tr>
                        ${item.specification ? `<tr><td colspan="5" style="font-style: italic; color: #666; padding: 5px;">Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª: ${item.specification}</td></tr>` : ''}
                    `).join('');
                }
                
                // Ø¨Ù†Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª - Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø£Ùˆ Ù†ØªØ±ÙƒÙ‡Ø§ ÙØ§Ø±ØºØ©
                const approval = request.approval_data || {};
                console.log('ğŸ” approval data for print:', approval);
                let approvalTable = `
                     <tr>
                         <td class="approval-label">Ø§Ù„Ø§Ø³Ù…</td>
                         <td><input type="text" class="approval-input" value="${approval.requester_name || request.requester || ''}" readonly></td>
                         <td><input type="text" class="approval-input" value="${approval.manager_name || ''}" readonly></td>
                         <td><input type="text" class="approval-input" value="${approval.finance_name || ''}" readonly></td>
                         <td><input type="text" class="approval-input" value="${approval.disbursement_name || ''}" readonly></td>
                     </tr>
                     <tr>
                         <td class="approval-label">Ø§Ù„Ù…Ù†ØµØ¨</td>
                         <td><input type="text" class="approval-input" value="${approval.requester_position || ''}" readonly></td>
                         <td><input type="text" class="approval-input" value="${approval.manager_position || ''}" readonly></td>
                         <td><input type="text" class="approval-input" value="${approval.finance_position || ''}" readonly></td>
                         <td><input type="text" class="approval-input" value="${approval.disbursement_position || ''}" readonly></td>
                     </tr>
                    <tr>
                        <td class="approval-label">Ø§Ù„ØªØ§Ø±ÙŠØ®</td>
                        <td><input type="text" class="approval-input" value="${approval.requester_date || request.date || (request.created_at ? new Date(request.created_at).toLocaleDateString('en-US') : '')}" readonly></td>
                        <td><input type="text" class="approval-input" value="${approval.manager_date || request.date || (request.created_at ? new Date(request.created_at).toLocaleDateString('en-US') : '')}" readonly></td>
                        <td><input type="text" class="approval-input" value="${approval.finance_date || request.date || (request.created_at ? new Date(request.created_at).toLocaleDateString('en-US') : '')}" readonly></td>
                        <td><input type="text" class="approval-input" value="${approval.disbursement_date || request.date || (request.created_at ? new Date(request.created_at).toLocaleDateString('en-US') : '')}" readonly></td>
                    </tr>
                    <tr class="signature-row">
                        <td class="approval-label">Ø§Ù„ØªÙˆÙ‚ÙŠØ¹</td>
                        <td class="signature-cell"></td>
                        <td class="signature-cell"></td>
                        <td class="signature-cell"></td>
                        <td class="signature-cell"></td>
                    </tr>
                `;
                
                const printContent = `
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡</title>
    <link rel="stylesheet" href="./css/fonts.css">
    <link rel="stylesheet" href="./css/style.css" />
</head>
<body>
    <div class="document-container">
        <div>
            <div class="sarh">ØµØ±Ø­ Ø§Ù„Ù‚Ø§Ø¨Ø¶Ø©</div>
            <div class="sarh">Sarh Holding</div>
        </div>
        <div class="main-title">Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡ - Purchase Request</div>

        <div class="header">
            <div class="supplier-info">
                <div class="info-row">
                    <span class="info-label">Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨:</span>
                    <input type="text" class="info-input" value="${request.requester || ''}" readonly>
                </div>
                <div class="info-row">
                    <span class="info-label">Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:</span>
                    <input type="text" class="info-input" value="${request.department || ''}" readonly>
                </div>
                <div class="info-row">
                    <span class="info-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªØ³Ù„ÙŠÙ…:</span>
                    <input type="text" class="info-input" value="${request.delivery_address || ''}" readonly>
                </div>
                <div class="info-row">
                    <span class="info-label">Ù…ÙˆØ¹Ø¯ Ø§Ù„ØªØ³Ù„ÙŠÙ…:</span>
                    <input type="date" class="info-input" value="${request.delivery_date || ''}" readonly>
                </div>
            </div>

            <div class="company-info">
                <div class="info-row">
                    <span class="info-label">ØªØ§Ø±ÙŠØ® Ø·Ù„Ø¨ Ø§Ù„Ø´Ø±Ø§Ø¡:</span>
                    <input type="date" class="info-input" value="${request.date || (request.created_at ? new Date(request.created_at).toISOString().split('T')[0] : '')}" readonly>
                </div>
                <div class="info-row">
                    <span class="info-label">Ø±Ù…Ø² Ø·Ù„Ø¨ Ø§Ù„Ø´Ø±Ø§Ø¡:</span>
                    <input type="text" class="info-input" value="${request.order_number || request.id}" readonly>
                </div>
                <div class="info-row">
                    <span class="info-label">ÙƒÙˆØ¯ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:</span>
                    <input type="text" class="info-input" value="${request.project_code || ''}" readonly>
                </div>
                <div class="info-row">
                    <span class="info-label">Ø§Ù„Ø¹Ù…Ù„Ø©:</span>
                    <select class="currency-select" readonly>
                        <option value="SYP" ${request.currency === 'SYP' ? 'selected' : ''}>Ù„ÙŠØ±Ø© Ø³ÙˆØ±ÙŠØ©</option>
                        <option value="USD" ${request.currency === 'USD' ? 'selected' : ''}>Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ</option>
                        <option value="EUR" ${request.currency === 'EUR' ? 'selected' : ''}>ÙŠÙˆØ±Ùˆ</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="table-section">
            <div class="section-title">Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</div>
            <table class="items-table">
                <thead>
                    <tr>
                        <th>Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù</th>
                        <th>Ø§Ù„ÙˆØ­Ø¯Ø©</th>
                        <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                        <th>Ø§Ù„Ø³Ø¹Ø±</th>
                        <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                    </tr>
                </thead>
                <tbody>
                    ${itemsTable}
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="4" class="total-label">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</td>
                        <td class="total-amount">${formatCurrency(request.total_amount, request.currency)}</td>
                    </tr>
                </tfoot>
            </table>
        </div>

        <div class="approval-section">
            <div class="section-title">Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª</div>
            <table class="approval-table">
                <thead>
                    <tr>
                        <th style="width: 12%">#</th>
                        <th style="width: 14%">Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                        <th style="width: 16%">Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</th>
                        <th style="width: 16%">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©</th>
                        <th style="width: 14%">Ø£Ù…Ø± Ø§Ù„ØµØ±Ù</th>
                    </tr>
                </thead>
                <tbody>
                    ${approvalTable}
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>
                `;
                
                printWindow.document.write(printContent);
                printWindow.document.close();
                
                // Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø«Ù… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
                printWindow.onload = function() {
                    printWindow.print();
                    printWindow.close();
                };
            }
        }
        
        function printRequest(requestId) {
            // ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø£ÙˆÙ„Ø§Ù‹ Ø«Ù… Ø·Ø¨Ø§Ø¹ØªÙ‡Ø§
            viewRequest(requestId);
            setTimeout(() => {
                printCurrentRequest();
            }, 500);
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ù‚Ø³Ù…
        document.addEventListener('DOMContentLoaded', function() {
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ù‚Ø³Ù… Ù…ØªØ§Ø¨Ø¹Ø© Ø³ÙŠØ± Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
            const trackRequestCard = document.querySelector('[onclick="showApp(\'track-request\')"]');
            if (trackRequestCard) {
                trackRequestCard.addEventListener('click', function() {
                    setTimeout(() => {
                        if (document.getElementById('track-request').classList.contains('active')) {
                            loadRequests();
                        }
                    }, 100);
                });
            }
        });

        function enforceRoleAccess(requiredRole) {
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            if (!user.role) return;
            if (user.role !== requiredRole) {
                if (user.role === 'admin') {
                    window.location.href = 'admin-dashboard.html';
                } else if (user.role === 'manager') {
                    window.location.href = 'manager-dashboard.html';
                } else if (user.role === 'finance') {
                    window.location.href = 'finance-dashboard.html';
                } else if (user.role === 'disbursement') {
                    window.location.href = 'disbursement-dashboard.html';
                } else {
                    window.location.href = 'login.html';
                }
            }
        }
        // Navigation functionality
        function showApp(appName) {
            // Hide all app contents
            const contents = document.querySelectorAll('.app-content');
            contents.forEach(content => content.classList.remove('active'));
            
            // Remove active class from all nav buttons
            const navBtns = document.querySelectorAll('.nav-btn');
            navBtns.forEach(btn => btn.classList.remove('active'));
            
            // Show selected app content
            document.getElementById(appName).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }

        function initTopNotifications() {
            const btn = document.getElementById('topNotificationsBtn');
            const badge = document.getElementById('topNotificationsBadge');
            const panel = document.getElementById('topNotificationsPanel');
            const list = document.getElementById('topNotificationsList');
            const markBtn = document.getElementById('markTopNotificationsRead');

            if (!btn || !badge || !panel || !list || !markBtn) {
                return;
            }

            if (topNotificationsInitialized) {
                if (topNotificationsIntervalId) {
                    clearInterval(topNotificationsIntervalId);
                }
                loadTopNotifications(true);
                topNotificationsIntervalId = setInterval(() => loadTopNotifications(true), 60000);
                return;
            }

            btn.addEventListener('click', toggleTopNotificationsPanel);
            markBtn.addEventListener('click', markAllTopNotificationsRead);
            if (!topNotificationsOutsideClickRegistered) {
                document.addEventListener('click', handleTopNotificationsOutsideClick);
                topNotificationsOutsideClickRegistered = true;
            }
            topNotificationsInitialized = true;

            loadTopNotifications(true);
            topNotificationsIntervalId = setInterval(() => loadTopNotifications(true), 60000);
        }

        function clearTopNotificationsInterval() {
            if (topNotificationsIntervalId) {
                clearInterval(topNotificationsIntervalId);
                topNotificationsIntervalId = null;
            }
        }

        function teardownTopNotifications() {
            topNotifications = [];
            clearTopNotificationsInterval();
            const badge = document.getElementById('topNotificationsBadge');
            const panel = document.getElementById('topNotificationsPanel');
            const list = document.getElementById('topNotificationsList');
            if (badge) {
                badge.style.display = 'none';
                badge.textContent = '0';
            }
            if (panel) {
                panel.classList.remove('active');
                panel.style.display = 'none';
            }
            if (list) {
                list.innerHTML = '<li class="top-notifications-empty">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</li>';
            }
        }

        async function loadTopNotifications(silent = false) {
            const token = localStorage.getItem('token');
            if (!token) {
                return;
            }
            try {
                const response = await fetch(`${API_BASE}/notifications`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (!response.ok) {
                    if (!silent) {
                        console.warn('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª:', response.status);
                    }
                    return;
                }
                const data = await response.json();
                topNotifications = Array.isArray(data) ? data : [];
                renderTopNotifications();
            } catch (error) {
                if (!silent) {
                    console.warn('Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª:', error);
                }
            }
        }

        function renderTopNotifications() {
            const badge = document.getElementById('topNotificationsBadge');
            const list = document.getElementById('topNotificationsList');
            if (!badge || !list) return;

            const unreadCount = topNotifications.filter(n => !n.is_read).length;
            if (unreadCount > 0) {
                badge.textContent = unreadCount;
                badge.style.display = 'inline-flex';
            } else {
                badge.style.display = 'none';
            }

            if (!topNotifications.length) {
                list.innerHTML = '<li class="top-notifications-empty">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</li>';
                return;
            }

            list.innerHTML = topNotifications.map(notif => {
                const createdAt = notif.created_at ? new Date(notif.created_at).toLocaleString('ar-SA') : '';
                const noteLine = notif.note ? `<small>Ù…Ù„Ø§Ø­Ø¸Ø©: ${notif.note}</small>` : '';
                return `<li class="${notif.is_read ? '' : 'unread'}">
                    <div>${notif.title || 'Ø¥Ø´Ø¹Ø§Ø±'}</div>
                    <div>${notif.message || ''}</div>
                    ${noteLine}
                    <small>${createdAt}</small>
                </li>`;
            }).join('');
        }

        function toggleTopNotificationsPanel() {
            const panel = document.getElementById('topNotificationsPanel');
            if (!panel) return;
            const willOpen = !panel.classList.contains('active');
            if (willOpen) {
                panel.classList.add('active');
                panel.style.display = 'flex';
                loadTopNotifications(true);
            } else {
                panel.classList.remove('active');
                panel.style.display = 'none';
            }
        }

        function handleTopNotificationsOutsideClick(event) {
            const panel = document.getElementById('topNotificationsPanel');
            const btn = document.getElementById('topNotificationsBtn');
            if (!panel || !btn) return;
            if (!panel.contains(event.target) && !btn.contains(event.target)) {
                panel.classList.remove('active');
                panel.style.display = 'none';
            }
        }

        async function markAllTopNotificationsRead() {
            const token = localStorage.getItem('token');
            if (!token) return;
            try {
                const response = await fetch(`${API_BASE}/notifications/read-all`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (response.ok) {
                    await loadTopNotifications(true);
                }
            } catch (error) {
                console.warn('ØªØ¹Ø°Ø± ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙƒÙ…Ù‚Ø±ÙˆØ¡Ø©:', error);
            }
        }
    </script>
    
    <!-- Modal for viewing request details -->
    <div id="requestModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</h2>
                <span class="close" onclick="closeRequestModal()">&times;</span>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Request details will be loaded here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeRequestModal()">Ø¥ØºÙ„Ø§Ù‚</button>
                <button class="btn btn-primary" onclick="printCurrentRequest()">Ø·Ø¨Ø§Ø¹Ø©</button>
            </div>
        </div>
    </div>
    
    <style>
        /* Modal styles */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 0;
            border: none;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .modal-header {
            background: linear-gradient(135deg, #698163 0%, #5a6f56 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            margin: 0;
            font-size: 24px;
        }
        
        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }
        
        .close:hover {
            opacity: 0.7;
        }
        
        .modal-body {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .modal-footer {
            padding: 20px;
            background-color: #f8f9fa;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .detail-item {
            display: flex;
            flex-direction: column;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        .detail-label {
            font-weight: bold;
            color: #698163;
            margin-bottom: 5px;
        }
        
        .detail-value {
            color: #333;
        }
        
        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .items-table th,
        .items-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        
        .items-table th {
            background-color: #698163;
            color: white;
        }
        
        .items-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }
        
        .btn-primary {
            background-color: #698163;
            color: white;
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .btn:hover {
            opacity: 0.8;
        }
        
        @media print {
            .modal {
                position: static !important;
                width: 100% !important;
                height: auto !important;
                background: transparent !important;
            }
            
            .modal-content {
                width: 100% !important;
                max-width: none !important;
                box-shadow: none !important;
                border: none !important;
            }
            
            .modal-header {
                background: #698163 !important;
                -webkit-print-color-adjust: exact;
                color-adjust: exact;
            }
            
            .modal-footer {
                display: none !important;
            }
        }
    </style>
    </script>
</body>
</html>
